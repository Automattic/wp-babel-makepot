#!/usr/bin/env node

'use strict';

/**
 * External dependencies.
 */
const program = require( 'commander' );
const process = require( 'process' );
const glob = require( 'glob' );
const os = require( 'os' );

/**
 * Internal dependencies.
 */
const makePot = require( '../index' );
const presets = require( '../presets' );
const version = require( '../package.json' ).version;

const presetsKeys = Object.keys( presets );

program
	.version( version )
	.option(
		'-p, --preset <type>',
		`Set babel preset. Available options: ${ presetsKeys.join( ', ' ) }`,
		'default'
	)
	.option( '-b, --base <type>', 'Set a directory that will be used as a base for the relative file path references in comments' )
	.option( '-i, --ignore <type>', 'Add pattern to exclude matches' )
	.action( ( command, [ files ] ) => {
		if ( ! presetsKeys.includes( program.preset ) ) {
			console.log(
				`Invalid babel preset. Please use any of available options: ${ presetsKeys.join( ', ' ) }`
			);

			return;
		}

		// Replace `~` with actual home directory as glob can't use it.
		const filesGlob = files.replace( /^~/, os.homedir() );
		const ignore = program.ignore && program.ignore.split( ',' );

		const { base } = program;

		glob.sync( filesGlob, { nodir: true, ignore } ).forEach( (filepath) => makePot(filepath, { base }) );
	} )
	.parse( process.argv );
